<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>fh_insert_json_to_database</title><meta name="description" content="Documentation for fh_insert_json_to_database"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">fh_insert_json_to_database</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1> fh_insert_json_to_database </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#소개" id="소개" style="color: inherit; text-decoration: none;">
  <h1>소개</h1>
</a>
<p>파머스핸즈 리포트카드, 소데이터 아웃풋 json파일을 데이터베이스에 삽입하는 스크립트입니다.</p>
<p><a href="https://bodit-inc.github.io/docs/fh-insert-json-to-database">Reference Documentation</a></p>

<a href="#report-카드-인풋-json-포맷" id="report-카드-인풋-json-포맷" style="color: inherit; text-decoration: none;">
  <h1>Report 카드 인풋 JSON 포맷</h1>
</a>
<pre><code class="language-json"><span class="hl-0">[</span><br/><span class="hl-0">  {</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;farm_id&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;FARM-010000&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;cow_id&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;COW-10000000&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;sensor_id&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;null&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;gateway_id&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;null&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;report_group&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;health_doubt&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;report_type&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;low&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-3">// DEPRECATED, 기존 사용자들은 하나의 액션만 표시할 수 있습니다. </span><br/><span class="hl-0">    </span><span class="hl-3">// 첫번째 액션의 title id를 입력합니다.</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;report_title_id&quot;</span><span class="hl-0">: </span><span class="hl-4">1002</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-3">// 여러개의 그래프를 표시할 때 사용합니다.</span><br/><span class="hl-0">    </span><span class="hl-3">// 그래프를 표시할 action들을 넣습니다.</span><br/><span class="hl-0">    </span><span class="hl-3">// 보통 card_data에 넣는 action들은 모두 넣습니다. action이 null인 것들은 넣지 않습니다.</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;actions&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;null&quot;</span><span class="hl-0"> </span><span class="hl-5">또는</span><span class="hl-0"> [</span><span class="hl-2">&quot;lactation&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;ruminant&quot;</span><span class="hl-0">],</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-1">&quot;feedback&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;null&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;self_diagnosis_id&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;null&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;level&quot;</span><span class="hl-0">: </span><span class="hl-4">1</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-3">// DEPRECATED, 기존 사용자들은 하나의 액션만 표시할 수 있습니다.</span><br/><span class="hl-0">    </span><span class="hl-3">// 첫번째 액션의 지속일자를 입력합니다.</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;continued_days&quot;</span><span class="hl-0">: </span><span class="hl-4">1</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-1">&quot;is_pinned&quot;</span><span class="hl-0">: </span><span class="hl-4">0</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;card_data&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">      </span><span class="hl-1">&quot;data&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;actions&quot;</span><span class="hl-0">: [</span><br/><span class="hl-0">          </span><span class="hl-3">// action이 있는 카드들은 아래처럼 넣습니다.</span><br/><span class="hl-0">          {</span><br/><span class="hl-0">            </span><span class="hl-1">&quot;action&quot;</span><span class="hl-0">: [</span><span class="hl-2">&quot;lactation&quot;</span><span class="hl-0">], </span><br/><span class="hl-0">            </span><span class="hl-1">&quot;continued_days&quot;</span><span class="hl-0">: </span><span class="hl-4">5</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-1">&quot;report_title_id&quot;</span><span class="hl-0">: </span><span class="hl-4">1000</span><br/><span class="hl-0">          },</span><br/><span class="hl-0">          </span><span class="hl-3">// action이 없는 카드(휴식, 센서탈거 등)들은 action을 null로 해서 넣습니다. </span><br/><span class="hl-0">          {</span><br/><span class="hl-0">            </span><span class="hl-1">&quot;action&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;null&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-1">&quot;continued_days&quot;</span><span class="hl-0">: </span><span class="hl-4">5</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-1">&quot;report_title_id&quot;</span><span class="hl-0">: </span><span class="hl-4">1000</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">          </span><span class="hl-3">// 추가 액션들 동일하게 넣습니다.</span><br/><span class="hl-0">        ]</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">      </span><span class="hl-1">&quot;version&quot;</span><span class="hl-0">: </span><span class="hl-4">1</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;target_at&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;2022-01-05 13:00:00&quot;</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">]</span>
</code></pre>

<a href="#cowdata-인풋-json-포맷" id="cowdata-인풋-json-포맷" style="color: inherit; text-decoration: none;">
  <h1>CowData 인풋 JSON 포맷</h1>
</a>
<pre><code class="language-json"><span class="hl-0">[</span><br/><span class="hl-0">  {</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;cow_id&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;COW-005021&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;datetime&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;2022-03-15 00:00:00&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;lactation&quot;</span><span class="hl-0">: </span><span class="hl-4">0</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;ruminant&quot;</span><span class="hl-0">: </span><span class="hl-4">0</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;eating&quot;</span><span class="hl-0">: </span><span class="hl-4">0</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;drinking&quot;</span><span class="hl-0">: </span><span class="hl-4">0</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;sitting&quot;</span><span class="hl-0">: </span><span class="hl-4">3420</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;standing&quot;</span><span class="hl-0">: </span><span class="hl-4">180</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;activity&quot;</span><span class="hl-0">: </span><span class="hl-4">0.0010618671843495857</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;cough&quot;</span><span class="hl-0">: </span><span class="hl-4">0</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;heading&quot;</span><span class="hl-0">: </span><span class="hl-4">0</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">]</span>
</code></pre>
<pre><code class="language-sql"><span class="hl-6">UPDATE</span><span class="hl-0"> </span><span class="hl-2">`Report`</span><br/><span class="hl-6">SET</span><span class="hl-0"> </span><span class="hl-2">`card_data`</span><span class="hl-0"> =</span><br/><span class="hl-0">        JSON_OBJECT(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">                    JSON_OBJECT(</span><span class="hl-2">&#39;actions&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">                                JSON_ARRAY(</span><br/><span class="hl-0">                                        JSON_OBJECT(</span><br/><span class="hl-0">                                                </span><span class="hl-2">&#39;action&#39;</span><span class="hl-0">, </span><span class="hl-6">IFNULL</span><span class="hl-0">(Report.actions, JSON_EXTRACT(Report.actions, </span><span class="hl-2">&#39;$[0]&#39;</span><span class="hl-0">)),</span><br/><span class="hl-0">                                                </span><span class="hl-2">&#39;continued_days&#39;</span><span class="hl-0">, Report.continued_days,</span><br/><span class="hl-0">                                                </span><span class="hl-2">&#39;report_title_id&#39;</span><span class="hl-0">, Report.report_title_id</span><br/><span class="hl-0">                                            )</span><br/><span class="hl-0">                                    )</span><br/><span class="hl-0">                        )</span><br/><span class="hl-0">            )</span>
</code></pre>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>